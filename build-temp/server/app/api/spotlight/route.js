"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/spotlight/route";
exports.ids = ["app/api/spotlight/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fspotlight%2Froute&page=%2Fapi%2Fspotlight%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fspotlight%2Froute.ts&appDir=%2Fhome%2Fsubvivah%2Fhtdocs%2Fsubvivah.com%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fsubvivah%2Fhtdocs%2Fsubvivah.com&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fspotlight%2Froute&page=%2Fapi%2Fspotlight%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fspotlight%2Froute.ts&appDir=%2Fhome%2Fsubvivah%2Fhtdocs%2Fsubvivah.com%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fsubvivah%2Fhtdocs%2Fsubvivah.com&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _home_subvivah_htdocs_subvivah_com_src_app_api_spotlight_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/spotlight/route.ts */ \"(rsc)/./src/app/api/spotlight/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/spotlight/route\",\n        pathname: \"/api/spotlight\",\n        filename: \"route\",\n        bundlePath: \"app/api/spotlight/route\"\n    },\n    resolvedPagePath: \"/home/subvivah/htdocs/subvivah.com/src/app/api/spotlight/route.ts\",\n    nextConfigOutput,\n    userland: _home_subvivah_htdocs_subvivah_com_src_app_api_spotlight_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/spotlight/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZzcG90bGlnaHQlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnNwb3RsaWdodCUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnNwb3RsaWdodCUyRnJvdXRlLnRzJmFwcERpcj0lMkZob21lJTJGc3Vidml2YWglMkZodGRvY3MlMkZzdWJ2aXZhaC5jb20lMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRmhvbWUlMkZzdWJ2aXZhaCUyRmh0ZG9jcyUyRnN1YnZpdmFoLmNvbSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD1zdGFuZGFsb25lJnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDaUI7QUFDOUY7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUM2Sjs7QUFFN0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWRkaW5nLXdlYnNpdGUvP2ZlYWMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL2hvbWUvc3Vidml2YWgvaHRkb2NzL3N1YnZpdmFoLmNvbS9zcmMvYXBwL2FwaS9zcG90bGlnaHQvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwic3RhbmRhbG9uZVwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9zcG90bGlnaHQvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9zcG90bGlnaHRcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3Nwb3RsaWdodC9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9ob21lL3N1YnZpdmFoL2h0ZG9jcy9zdWJ2aXZhaC5jb20vc3JjL2FwcC9hcGkvc3BvdGxpZ2h0L3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3Nwb3RsaWdodC9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fspotlight%2Froute&page=%2Fapi%2Fspotlight%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fspotlight%2Froute.ts&appDir=%2Fhome%2Fsubvivah%2Fhtdocs%2Fsubvivah.com%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fsubvivah%2Fhtdocs%2Fsubvivah.com&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/spotlight/route.ts":
/*!****************************************!*\
  !*** ./src/app/api/spotlight/route.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   dynamic: () => (/* binding */ dynamic)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/db */ \"(rsc)/./src/lib/db.ts\");\n\n\nconst dynamic = \"force-dynamic\";\nasync function GET(request) {\n    try {\n        const { searchParams } = new URL(request.url);\n        const userId = searchParams.get(\"userId\");\n        const getAll = searchParams.get(\"all\") === \"true\";\n        if (!userId) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"User ID is required\"\n            }, {\n                status: 400\n            });\n        }\n        console.log(\"Fetching matches for user:\", userId);\n        try {\n            // Get user's profile first to determine gender\n            const userProfile = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.prisma.profile.findUnique({\n                where: {\n                    userId\n                },\n                include: {\n                    user: true\n                }\n            });\n            if (!userProfile) {\n                console.log(\"User profile not found for ID:\", userId);\n                return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                    error: \"User profile not found\"\n                }, {\n                    status: 404\n                });\n            }\n            const userGender = userProfile.user.gender?.toUpperCase();\n            console.log(\"User gender:\", userGender);\n            // Get user's preferences\n            const userPreferences = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.prisma.preferences.findUnique({\n                where: {\n                    userId\n                }\n            });\n            if (!userPreferences) {\n                console.log(\"User preferences not found for ID:\", userId);\n                return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                    error: \"User preferences not found\"\n                }, {\n                    status: 404\n                });\n            }\n            console.log(\"Found user preferences:\", userPreferences);\n            // Find potential matches with gender filter\n            const potentialMatches = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.prisma.profile.findMany({\n                where: {\n                    userId: {\n                        not: userId\n                    },\n                    user: {\n                        gender: {\n                            equals: userGender === \"MALE\" ? \"FEMALE\" : \"MALE\",\n                            mode: \"insensitive\" // Case-insensitive comparison\n                        }\n                    }\n                },\n                select: {\n                    id: true,\n                    userId: true,\n                    height: true,\n                    maritalStatus: true,\n                    religion: true,\n                    caste: true,\n                    education: true,\n                    occupation: true,\n                    workLocation: true,\n                    aboutMe: true,\n                    user: {\n                        select: {\n                            id: true,\n                            email: true,\n                            firstName: true,\n                            lastName: true,\n                            dob: true,\n                            gender: true\n                        }\n                    }\n                }\n            });\n            console.log(\"Found potential matches:\", potentialMatches.length);\n            if (potentialMatches.length === 0) {\n                return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                    error: \"No potential matches found\"\n                }, {\n                    status: 404\n                });\n            }\n            // Calculate match score for each potential match\n            const scoredMatches = potentialMatches.map((match)=>{\n                try {\n                    let score = 0;\n                    let matchingCriteria = [];\n                    // Age match (20 points)\n                    if (userPreferences.ageFrom && userPreferences.ageTo && match.user.dob) {\n                        const age = new Date().getFullYear() - new Date(match.user.dob).getFullYear();\n                        if (age >= userPreferences.ageFrom && age <= userPreferences.ageTo) {\n                            score += 20;\n                            matchingCriteria.push(\"Age\");\n                        }\n                    }\n                    // Religion match (20 points)\n                    if (userPreferences.religion && match.religion?.toLowerCase() === userPreferences.religion.toLowerCase()) {\n                        score += 20;\n                        matchingCriteria.push(\"Religion\");\n                    }\n                    // Education match (15 points)\n                    if (userPreferences.education && match.education?.toLowerCase() === userPreferences.education.toLowerCase()) {\n                        score += 15;\n                        matchingCriteria.push(\"Education\");\n                    }\n                    // Height match (15 points)\n                    if (userPreferences.heightFrom && userPreferences.heightTo && match.height) {\n                        try {\n                            const heightInCm = parseInt(match.height);\n                            const minHeight = parseInt(userPreferences.heightFrom);\n                            const maxHeight = parseInt(userPreferences.heightTo);\n                            if (!isNaN(heightInCm) && !isNaN(minHeight) && !isNaN(maxHeight) && heightInCm >= minHeight && heightInCm <= maxHeight) {\n                                score += 15;\n                                matchingCriteria.push(\"Height\");\n                            }\n                        } catch (error) {\n                            console.error(\"Error parsing height:\", error);\n                        }\n                    }\n                    // Location match (15 points)\n                    if (userPreferences.location && match.workLocation?.toLowerCase() === userPreferences.location.toLowerCase()) {\n                        score += 15;\n                        matchingCriteria.push(\"Location\");\n                    }\n                    // Occupation match (10 points)\n                    if (userPreferences.occupation && match.occupation?.toLowerCase() === userPreferences.occupation.toLowerCase()) {\n                        score += 10;\n                        matchingCriteria.push(\"Occupation\");\n                    }\n                    // Marital status match (5 points)\n                    if (userPreferences.maritalStatus && match.maritalStatus?.toLowerCase() === userPreferences.maritalStatus.toLowerCase()) {\n                        score += 5;\n                        matchingCriteria.push(\"Marital Status\");\n                    }\n                    return {\n                        profile: match,\n                        matchScore: score,\n                        matchingCriteria\n                    };\n                } catch (error) {\n                    console.error(\"Error scoring match:\", error);\n                    return {\n                        profile: match,\n                        matchScore: 0,\n                        matchingCriteria: []\n                    };\n                }\n            });\n            // Sort by match score\n            const sortedMatches = scoredMatches.sort((a, b)=>b.matchScore - a.matchScore);\n            if (getAll) {\n                // Return all matches\n                return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                    matches: sortedMatches\n                });\n            } else {\n                // Return only the best match\n                const bestMatch = sortedMatches[0];\n                if (!bestMatch || bestMatch.matchScore < 20) {\n                    return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                        error: \"No suitable matches found\"\n                    }, {\n                        status: 404\n                    });\n                }\n                return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                    matchedProfile: bestMatch.profile,\n                    matchScore: bestMatch.matchScore,\n                    matchingCriteria: bestMatch.matchingCriteria\n                });\n            }\n        } catch (error) {\n            console.error(\"Database operation error:\", error);\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Database operation failed\",\n                details: error instanceof Error ? error.message : \"Unknown error\"\n            }, {\n                status: 500\n            });\n        }\n    } catch (error) {\n        console.error(\"API error:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Internal server error\",\n            details: error instanceof Error ? error.message : \"Unknown error\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LENBQUM7b0JBQ3ZCNkQsU0FBU0o7Z0JBQ1g7WUFDRixPQUFPO2dCQUNMLDZCQUE2QjtnQkFDN0IsTUFBTUssWUFBWUwsYUFBYSxDQUFDLEVBQUU7Z0JBRWxDLElBQUksQ0FBQ0ssYUFBYUEsVUFBVU4sVUFBVSxHQUFHLElBQUk7b0JBQzNDLE9BQU9uRSxrRkFBWUEsQ0FBQ1csSUFBSSxDQUN0Qjt3QkFBRUMsT0FBTztvQkFBNEIsR0FDckM7d0JBQUVDLFFBQVE7b0JBQUk7Z0JBRWxCO2dCQUVBLE9BQU9iLGtGQUFZQSxDQUFDVyxJQUFJLENBQUM7b0JBQ3ZCK0QsZ0JBQWdCRCxVQUFVeEQsT0FBTztvQkFDakNrRCxZQUFZTSxVQUFVTixVQUFVO29CQUNoQ2hCLGtCQUFrQnNCLFVBQVV0QixnQkFBZ0I7Z0JBQzlDO1lBQ0Y7UUFDRixFQUFFLE9BQU92QyxPQUFPO1lBQ2RFLFFBQVFGLEtBQUssQ0FBQyw2QkFBNkJBO1lBQzNDLE9BQU9aLGtGQUFZQSxDQUFDVyxJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO2dCQUE2QitELFNBQVMvRCxpQkFBaUJnRSxRQUFRaEUsTUFBTWlFLE9BQU8sR0FBRztZQUFnQixHQUN4RztnQkFBRWhFLFFBQVE7WUFBSTtRQUVsQjtJQUNGLEVBQUUsT0FBT0QsT0FBTztRQUNkRSxRQUFRRixLQUFLLENBQUMsY0FBY0E7UUFDNUIsT0FBT1osa0ZBQVlBLENBQUNXLElBQUksQ0FDdEI7WUFBRUMsT0FBTztZQUF5QitELFNBQVMvRCxpQkFBaUJnRSxRQUFRaEUsTUFBTWlFLE9BQU8sR0FBRztRQUFnQixHQUNwRztZQUFFaEUsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWRkaW5nLXdlYnNpdGUvLi9zcmMvYXBwL2FwaS9zcG90bGlnaHQvcm91dGUudHM/MTUxYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICdAL2xpYi9kYic7XG5cbmV4cG9ydCBjb25zdCBkeW5hbWljID0gJ2ZvcmNlLWR5bmFtaWMnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XG4gICAgY29uc3QgdXNlcklkID0gc2VhcmNoUGFyYW1zLmdldCgndXNlcklkJyk7XG4gICAgY29uc3QgZ2V0QWxsID0gc2VhcmNoUGFyYW1zLmdldCgnYWxsJykgPT09ICd0cnVlJztcblxuICAgIGlmICghdXNlcklkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdVc2VyIElEIGlzIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ0ZldGNoaW5nIG1hdGNoZXMgZm9yIHVzZXI6JywgdXNlcklkKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgdXNlcidzIHByb2ZpbGUgZmlyc3QgdG8gZGV0ZXJtaW5lIGdlbmRlclxuICAgICAgY29uc3QgdXNlclByb2ZpbGUgPSBhd2FpdCBwcmlzbWEucHJvZmlsZS5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkIH0sXG4gICAgICAgIGluY2x1ZGU6IHsgdXNlcjogdHJ1ZSB9XG4gICAgICB9KTtcblxuICAgICAgaWYgKCF1c2VyUHJvZmlsZSkge1xuICAgICAgICBjb25zb2xlLmxvZygnVXNlciBwcm9maWxlIG5vdCBmb3VuZCBmb3IgSUQ6JywgdXNlcklkKTtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHsgZXJyb3I6ICdVc2VyIHByb2ZpbGUgbm90IGZvdW5kJyB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDQgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB1c2VyR2VuZGVyID0gdXNlclByb2ZpbGUudXNlci5nZW5kZXI/LnRvVXBwZXJDYXNlKCk7XG4gICAgICBjb25zb2xlLmxvZygnVXNlciBnZW5kZXI6JywgdXNlckdlbmRlcik7XG5cbiAgICAgIC8vIEdldCB1c2VyJ3MgcHJlZmVyZW5jZXNcbiAgICAgIGNvbnN0IHVzZXJQcmVmZXJlbmNlcyA9IGF3YWl0IHByaXNtYS5wcmVmZXJlbmNlcy5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkIH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXVzZXJQcmVmZXJlbmNlcykge1xuICAgICAgICBjb25zb2xlLmxvZygnVXNlciBwcmVmZXJlbmNlcyBub3QgZm91bmQgZm9yIElEOicsIHVzZXJJZCk7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7IGVycm9yOiAnVXNlciBwcmVmZXJlbmNlcyBub3QgZm91bmQnIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKCdGb3VuZCB1c2VyIHByZWZlcmVuY2VzOicsIHVzZXJQcmVmZXJlbmNlcyk7XG5cbiAgICAgIC8vIEZpbmQgcG90ZW50aWFsIG1hdGNoZXMgd2l0aCBnZW5kZXIgZmlsdGVyXG4gICAgICBjb25zdCBwb3RlbnRpYWxNYXRjaGVzID0gYXdhaXQgcHJpc21hLnByb2ZpbGUuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIHVzZXJJZDogeyBub3Q6IHVzZXJJZCB9LCAvLyBFeGNsdWRlIHNlbGZcbiAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICBnZW5kZXI6IHtcbiAgICAgICAgICAgICAgZXF1YWxzOiB1c2VyR2VuZGVyID09PSAnTUFMRScgPyAnRkVNQUxFJyA6ICdNQUxFJyxcbiAgICAgICAgICAgICAgbW9kZTogJ2luc2Vuc2l0aXZlJyAvLyBDYXNlLWluc2Vuc2l0aXZlIGNvbXBhcmlzb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgIHVzZXJJZDogdHJ1ZSxcbiAgICAgICAgICBoZWlnaHQ6IHRydWUsXG4gICAgICAgICAgbWFyaXRhbFN0YXR1czogdHJ1ZSxcbiAgICAgICAgICByZWxpZ2lvbjogdHJ1ZSxcbiAgICAgICAgICBjYXN0ZTogdHJ1ZSxcbiAgICAgICAgICBlZHVjYXRpb246IHRydWUsXG4gICAgICAgICAgb2NjdXBhdGlvbjogdHJ1ZSxcbiAgICAgICAgICB3b3JrTG9jYXRpb246IHRydWUsXG4gICAgICAgICAgYWJvdXRNZTogdHJ1ZSxcbiAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBkb2I6IHRydWUsXG4gICAgICAgICAgICAgIGdlbmRlcjogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnNvbGUubG9nKCdGb3VuZCBwb3RlbnRpYWwgbWF0Y2hlczonLCBwb3RlbnRpYWxNYXRjaGVzLmxlbmd0aCk7XG5cbiAgICAgIGlmIChwb3RlbnRpYWxNYXRjaGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBlcnJvcjogJ05vIHBvdGVudGlhbCBtYXRjaGVzIGZvdW5kJyB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDQgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBDYWxjdWxhdGUgbWF0Y2ggc2NvcmUgZm9yIGVhY2ggcG90ZW50aWFsIG1hdGNoXG4gICAgICBjb25zdCBzY29yZWRNYXRjaGVzID0gcG90ZW50aWFsTWF0Y2hlcy5tYXAobWF0Y2ggPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGxldCBzY29yZSA9IDA7XG4gICAgICAgICAgbGV0IG1hdGNoaW5nQ3JpdGVyaWEgPSBbXTtcblxuICAgICAgICAgIC8vIEFnZSBtYXRjaCAoMjAgcG9pbnRzKVxuICAgICAgICAgIGlmICh1c2VyUHJlZmVyZW5jZXMuYWdlRnJvbSAmJiB1c2VyUHJlZmVyZW5jZXMuYWdlVG8gJiYgbWF0Y2gudXNlci5kb2IpIHtcbiAgICAgICAgICAgIGNvbnN0IGFnZSA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSAtIG5ldyBEYXRlKG1hdGNoLnVzZXIuZG9iKS5nZXRGdWxsWWVhcigpO1xuICAgICAgICAgICAgaWYgKGFnZSA+PSB1c2VyUHJlZmVyZW5jZXMuYWdlRnJvbSAmJiBhZ2UgPD0gdXNlclByZWZlcmVuY2VzLmFnZVRvKSB7XG4gICAgICAgICAgICAgIHNjb3JlICs9IDIwO1xuICAgICAgICAgICAgICBtYXRjaGluZ0NyaXRlcmlhLnB1c2goJ0FnZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFJlbGlnaW9uIG1hdGNoICgyMCBwb2ludHMpXG4gICAgICAgICAgaWYgKHVzZXJQcmVmZXJlbmNlcy5yZWxpZ2lvbiAmJiBtYXRjaC5yZWxpZ2lvbj8udG9Mb3dlckNhc2UoKSA9PT0gdXNlclByZWZlcmVuY2VzLnJlbGlnaW9uLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgIHNjb3JlICs9IDIwO1xuICAgICAgICAgICAgbWF0Y2hpbmdDcml0ZXJpYS5wdXNoKCdSZWxpZ2lvbicpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIEVkdWNhdGlvbiBtYXRjaCAoMTUgcG9pbnRzKVxuICAgICAgICAgIGlmICh1c2VyUHJlZmVyZW5jZXMuZWR1Y2F0aW9uICYmIG1hdGNoLmVkdWNhdGlvbj8udG9Mb3dlckNhc2UoKSA9PT0gdXNlclByZWZlcmVuY2VzLmVkdWNhdGlvbi50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICBzY29yZSArPSAxNTtcbiAgICAgICAgICAgIG1hdGNoaW5nQ3JpdGVyaWEucHVzaCgnRWR1Y2F0aW9uJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gSGVpZ2h0IG1hdGNoICgxNSBwb2ludHMpXG4gICAgICAgICAgaWYgKHVzZXJQcmVmZXJlbmNlcy5oZWlnaHRGcm9tICYmIHVzZXJQcmVmZXJlbmNlcy5oZWlnaHRUbyAmJiBtYXRjaC5oZWlnaHQpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGNvbnN0IGhlaWdodEluQ20gPSBwYXJzZUludChtYXRjaC5oZWlnaHQpO1xuICAgICAgICAgICAgICBjb25zdCBtaW5IZWlnaHQgPSBwYXJzZUludCh1c2VyUHJlZmVyZW5jZXMuaGVpZ2h0RnJvbSk7XG4gICAgICAgICAgICAgIGNvbnN0IG1heEhlaWdodCA9IHBhcnNlSW50KHVzZXJQcmVmZXJlbmNlcy5oZWlnaHRUbyk7XG4gICAgICAgICAgICAgIGlmICghaXNOYU4oaGVpZ2h0SW5DbSkgJiYgIWlzTmFOKG1pbkhlaWdodCkgJiYgIWlzTmFOKG1heEhlaWdodCkgJiZcbiAgICAgICAgICAgICAgICAgIGhlaWdodEluQ20gPj0gbWluSGVpZ2h0ICYmIGhlaWdodEluQ20gPD0gbWF4SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgc2NvcmUgKz0gMTU7XG4gICAgICAgICAgICAgICAgbWF0Y2hpbmdDcml0ZXJpYS5wdXNoKCdIZWlnaHQnKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcGFyc2luZyBoZWlnaHQ6JywgZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIExvY2F0aW9uIG1hdGNoICgxNSBwb2ludHMpXG4gICAgICAgICAgaWYgKHVzZXJQcmVmZXJlbmNlcy5sb2NhdGlvbiAmJiBtYXRjaC53b3JrTG9jYXRpb24/LnRvTG93ZXJDYXNlKCkgPT09IHVzZXJQcmVmZXJlbmNlcy5sb2NhdGlvbi50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICBzY29yZSArPSAxNTtcbiAgICAgICAgICAgIG1hdGNoaW5nQ3JpdGVyaWEucHVzaCgnTG9jYXRpb24nKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBPY2N1cGF0aW9uIG1hdGNoICgxMCBwb2ludHMpXG4gICAgICAgICAgaWYgKHVzZXJQcmVmZXJlbmNlcy5vY2N1cGF0aW9uICYmIG1hdGNoLm9jY3VwYXRpb24/LnRvTG93ZXJDYXNlKCkgPT09IHVzZXJQcmVmZXJlbmNlcy5vY2N1cGF0aW9uLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgIHNjb3JlICs9IDEwO1xuICAgICAgICAgICAgbWF0Y2hpbmdDcml0ZXJpYS5wdXNoKCdPY2N1cGF0aW9uJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gTWFyaXRhbCBzdGF0dXMgbWF0Y2ggKDUgcG9pbnRzKVxuICAgICAgICAgIGlmICh1c2VyUHJlZmVyZW5jZXMubWFyaXRhbFN0YXR1cyAmJiBtYXRjaC5tYXJpdGFsU3RhdHVzPy50b0xvd2VyQ2FzZSgpID09PSB1c2VyUHJlZmVyZW5jZXMubWFyaXRhbFN0YXR1cy50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICBzY29yZSArPSA1O1xuICAgICAgICAgICAgbWF0Y2hpbmdDcml0ZXJpYS5wdXNoKCdNYXJpdGFsIFN0YXR1cycpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwcm9maWxlOiBtYXRjaCxcbiAgICAgICAgICAgIG1hdGNoU2NvcmU6IHNjb3JlLFxuICAgICAgICAgICAgbWF0Y2hpbmdDcml0ZXJpYVxuICAgICAgICAgIH07XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc2NvcmluZyBtYXRjaDonLCBlcnJvcik7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHByb2ZpbGU6IG1hdGNoLFxuICAgICAgICAgICAgbWF0Y2hTY29yZTogMCxcbiAgICAgICAgICAgIG1hdGNoaW5nQ3JpdGVyaWE6IFtdXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIFNvcnQgYnkgbWF0Y2ggc2NvcmVcbiAgICAgIGNvbnN0IHNvcnRlZE1hdGNoZXMgPSBzY29yZWRNYXRjaGVzLnNvcnQoKGEsIGIpID0+IGIubWF0Y2hTY29yZSAtIGEubWF0Y2hTY29yZSk7XG5cbiAgICAgIGlmIChnZXRBbGwpIHtcbiAgICAgICAgLy8gUmV0dXJuIGFsbCBtYXRjaGVzXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgbWF0Y2hlczogc29ydGVkTWF0Y2hlc1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFJldHVybiBvbmx5IHRoZSBiZXN0IG1hdGNoXG4gICAgICAgIGNvbnN0IGJlc3RNYXRjaCA9IHNvcnRlZE1hdGNoZXNbMF07XG5cbiAgICAgICAgaWYgKCFiZXN0TWF0Y2ggfHwgYmVzdE1hdGNoLm1hdGNoU2NvcmUgPCAyMCkge1xuICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICAgIHsgZXJyb3I6ICdObyBzdWl0YWJsZSBtYXRjaGVzIGZvdW5kJyB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgbWF0Y2hlZFByb2ZpbGU6IGJlc3RNYXRjaC5wcm9maWxlLFxuICAgICAgICAgIG1hdGNoU2NvcmU6IGJlc3RNYXRjaC5tYXRjaFNjb3JlLFxuICAgICAgICAgIG1hdGNoaW5nQ3JpdGVyaWE6IGJlc3RNYXRjaC5tYXRjaGluZ0NyaXRlcmlhXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdEYXRhYmFzZSBvcGVyYXRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnRGF0YWJhc2Ugb3BlcmF0aW9uIGZhaWxlZCcsIGRldGFpbHM6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignQVBJIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJywgZGV0YWlsczogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn0gIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInByaXNtYSIsImR5bmFtaWMiLCJHRVQiLCJyZXF1ZXN0Iiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwidXNlcklkIiwiZ2V0IiwiZ2V0QWxsIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwiY29uc29sZSIsImxvZyIsInVzZXJQcm9maWxlIiwicHJvZmlsZSIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImluY2x1ZGUiLCJ1c2VyIiwidXNlckdlbmRlciIsImdlbmRlciIsInRvVXBwZXJDYXNlIiwidXNlclByZWZlcmVuY2VzIiwicHJlZmVyZW5jZXMiLCJwb3RlbnRpYWxNYXRjaGVzIiwiZmluZE1hbnkiLCJub3QiLCJlcXVhbHMiLCJtb2RlIiwic2VsZWN0IiwiaWQiLCJoZWlnaHQiLCJtYXJpdGFsU3RhdHVzIiwicmVsaWdpb24iLCJjYXN0ZSIsImVkdWNhdGlvbiIsIm9jY3VwYXRpb24iLCJ3b3JrTG9jYXRpb24iLCJhYm91dE1lIiwiZW1haWwiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsImRvYiIsImxlbmd0aCIsInNjb3JlZE1hdGNoZXMiLCJtYXAiLCJtYXRjaCIsInNjb3JlIiwibWF0Y2hpbmdDcml0ZXJpYSIsImFnZUZyb20iLCJhZ2VUbyIsImFnZSIsIkRhdGUiLCJnZXRGdWxsWWVhciIsInB1c2giLCJ0b0xvd2VyQ2FzZSIsImhlaWdodEZyb20iLCJoZWlnaHRUbyIsImhlaWdodEluQ20iLCJwYXJzZUludCIsIm1pbkhlaWdodCIsIm1heEhlaWdodCIsImlzTmFOIiwibG9jYXRpb24iLCJtYXRjaFNjb3JlIiwic29ydGVkTWF0Y2hlcyIsInNvcnQiLCJhIiwiYiIsIm1hdGNoZXMiLCJiZXN0TWF0Y2giLCJtYXRjaGVkUHJvZmlsZSIsImRldGFpbHMiLCJFcnJvciIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/spotlight/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/db.ts":
/*!***********************!*\
  !*** ./src/lib/db.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n    log: [\n        \"query\",\n        \"error\",\n        \"warn\"\n    ],\n    datasources: {\n        db: {\n            url: process.env.DATABASE_URL\n        }\n    }\n});\nif (true) globalForPrisma.prisma = prisma;\n// Handle database connection with retry logic\nconst connectWithRetry = async (retries = 3, delay = 1000)=>{\n    for(let i = 0; i < retries; i++){\n        try {\n            await prisma.$connect();\n            console.log(\"Successfully connected to MongoDB via Prisma\");\n            return;\n        } catch (err) {\n            console.error(`Failed to connect to database (attempt ${i + 1}/${retries}):`, err);\n            if (i === retries - 1) {\n                console.error(\"Max retries reached. Exiting process...\");\n                process.exit(1);\n            }\n            console.log(`Retrying in ${delay}ms...`);\n            await new Promise((resolve)=>setTimeout(resolve, delay));\n        }\n    }\n};\nconnectWithRetry();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2RiLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUE4QztBQUU5QyxNQUFNQyxrQkFBa0JDO0FBSWpCLE1BQU1DLFNBQVNGLGdCQUFnQkUsTUFBTSxJQUFJLElBQUlILHdEQUFZQSxDQUFDO0lBQy9ESSxLQUFLO1FBQUM7UUFBUztRQUFTO0tBQU87SUFDL0JDLGFBQWE7UUFDWEMsSUFBSTtZQUNGQyxLQUFLQyxRQUFRQyxHQUFHLENBQUNDLFlBQVk7UUFDL0I7SUFDRjtBQUNGLEdBQUc7QUFFSCxJQUFJRixJQUF5QixFQUFjUCxnQkFBZ0JFLE1BQU0sR0FBR0E7QUFFcEUsOENBQThDO0FBQzlDLE1BQU1RLG1CQUFtQixPQUFPQyxVQUFVLENBQUMsRUFBRUMsUUFBUSxJQUFJO0lBQ3ZELElBQUssSUFBSUMsSUFBSSxHQUFHQSxJQUFJRixTQUFTRSxJQUFLO1FBQ2hDLElBQUk7WUFDRixNQUFNWCxPQUFPWSxRQUFRO1lBQ3JCQyxRQUFRWixHQUFHLENBQUM7WUFDWjtRQUNGLEVBQUUsT0FBT2EsS0FBSztZQUNaRCxRQUFRRSxLQUFLLENBQUMsQ0FBQyx1Q0FBdUMsRUFBRUosSUFBSSxFQUFFLENBQUMsRUFBRUYsUUFBUSxFQUFFLENBQUMsRUFBRUs7WUFDOUUsSUFBSUgsTUFBTUYsVUFBVSxHQUFHO2dCQUNyQkksUUFBUUUsS0FBSyxDQUFDO2dCQUNkVixRQUFRVyxJQUFJLENBQUM7WUFDZjtZQUNBSCxRQUFRWixHQUFHLENBQUMsQ0FBQyxZQUFZLEVBQUVTLE1BQU0sS0FBSyxDQUFDO1lBQ3ZDLE1BQU0sSUFBSU8sUUFBUUMsQ0FBQUEsVUFBV0MsV0FBV0QsU0FBU1I7UUFDbkQ7SUFDRjtBQUNGO0FBRUFGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2VkZGluZy13ZWJzaXRlLy4vc3JjL2xpYi9kYi50cz85ZTRmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcblxuY29uc3QgZ2xvYmFsRm9yUHJpc21hID0gZ2xvYmFsVGhpcyBhcyB1bmtub3duIGFzIHtcbiAgcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWQ7XG59O1xuXG5leHBvcnQgY29uc3QgcHJpc21hID0gZ2xvYmFsRm9yUHJpc21hLnByaXNtYSA/PyBuZXcgUHJpc21hQ2xpZW50KHtcbiAgbG9nOiBbJ3F1ZXJ5JywgJ2Vycm9yJywgJ3dhcm4nXSxcbiAgZGF0YXNvdXJjZXM6IHtcbiAgICBkYjoge1xuICAgICAgdXJsOiBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwsXG4gICAgfSxcbiAgfSxcbn0pO1xuXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgZ2xvYmFsRm9yUHJpc21hLnByaXNtYSA9IHByaXNtYTtcblxuLy8gSGFuZGxlIGRhdGFiYXNlIGNvbm5lY3Rpb24gd2l0aCByZXRyeSBsb2dpY1xuY29uc3QgY29ubmVjdFdpdGhSZXRyeSA9IGFzeW5jIChyZXRyaWVzID0gMywgZGVsYXkgPSAxMDAwKSA9PiB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcmV0cmllczsgaSsrKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHByaXNtYS4kY29ubmVjdCgpO1xuICAgICAgY29uc29sZS5sb2coJ1N1Y2Nlc3NmdWxseSBjb25uZWN0ZWQgdG8gTW9uZ29EQiB2aWEgUHJpc21hJyk7XG4gICAgICByZXR1cm47XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gY29ubmVjdCB0byBkYXRhYmFzZSAoYXR0ZW1wdCAke2kgKyAxfS8ke3JldHJpZXN9KTpgLCBlcnIpO1xuICAgICAgaWYgKGkgPT09IHJldHJpZXMgLSAxKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ01heCByZXRyaWVzIHJlYWNoZWQuIEV4aXRpbmcgcHJvY2Vzcy4uLicpO1xuICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhgUmV0cnlpbmcgaW4gJHtkZWxheX1tcy4uLmApO1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIGRlbGF5KSk7XG4gICAgfVxuICB9XG59O1xuXG5jb25uZWN0V2l0aFJldHJ5KCk7ICJdLCJuYW1lcyI6WyJQcmlzbWFDbGllbnQiLCJnbG9iYWxGb3JQcmlzbWEiLCJnbG9iYWxUaGlzIiwicHJpc21hIiwibG9nIiwiZGF0YXNvdXJjZXMiLCJkYiIsInVybCIsInByb2Nlc3MiLCJlbnYiLCJEQVRBQkFTRV9VUkwiLCJjb25uZWN0V2l0aFJldHJ5IiwicmV0cmllcyIsImRlbGF5IiwiaSIsIiRjb25uZWN0IiwiY29uc29sZSIsImVyciIsImVycm9yIiwiZXhpdCIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/db.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fspotlight%2Froute&page=%2Fapi%2Fspotlight%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fspotlight%2Froute.ts&appDir=%2Fhome%2Fsubvivah%2Fhtdocs%2Fsubvivah.com%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fsubvivah%2Fhtdocs%2Fsubvivah.com&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();