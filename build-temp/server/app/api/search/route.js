"use strict";(()=>{var e={};e.id=280,e.ids=[280],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},26266:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>m,originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>f});var o={};r.r(o),r.d(o,{GET:()=>u,dynamic:()=>c});var a=r(95419),n=r(69108),s=r(99678),i=r(78070),l=r(81494);let c="force-dynamic";async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("age"),o=t.get("location"),a=t.get("education"),n=t.get("profession"),s=t.get("religion"),c=t.get("caste"),u=parseInt(t.get("page")||"1"),p=parseInt(t.get("limit")||"12");try{let e={},t=!1;if(r){let[o,a]=r.split("-").map(Number);e.dateOfBirth={gte:new Date(new Date().setFullYear(new Date().getFullYear()-a)),lte:new Date(new Date().setFullYear(new Date().getFullYear()-o))},t=!0}let d={high_school:"High School",bachelors:"Bachelor's Degree",masters:"Master's Degree",phd:"PhD"},h=a&&d[a]?d[a]:a;if(o&&(e.location={contains:o,mode:"insensitive"},t=!0),h&&(e.education={contains:h,mode:"insensitive"},t=!0),n&&(e.profession={contains:n,mode:"insensitive"},t=!0),s&&(e.religion={equals:s,mode:"insensitive"},t=!0),c&&(e.caste={contains:c,mode:"insensitive"},t=!0),!t)return new i.Z(JSON.stringify({profiles:[],total:0,page:u,totalPages:0}),{status:200,headers:{"Content-Type":"application/json"}});console.log("Search query:",e);let g=await l._.profile.findMany({where:e,include:{user:{include:{photos:{where:{isProfile:!0},take:1}}}},orderBy:{createdAt:"desc"},skip:(u-1)*p,take:p});console.log("Number of profiles found:",g.length);let m=await l._.profile.count({where:e});return new i.Z(JSON.stringify({profiles:g,total:m,page:u,totalPages:Math.ceil(m/p)}),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Database error:",e),new i.Z(JSON.stringify({error:"Failed to fetch profiles"}),{status:500,headers:{"Content-Type":"application/json"}})}}catch(e){return console.error("API error:",e),new i.Z(JSON.stringify({error:"Internal server error"}),{status:500,headers:{"Content-Type":"application/json"}})}}let p=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/search/route",pathname:"/api/search",filename:"route",bundlePath:"app/api/search/route"},resolvedPagePath:"/home/subvivah/htdocs/subvivah.com/src/app/api/search/route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:g,headerHooks:m,staticGenerationBailout:f}=p,w="/api/search/route";function y(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},81494:(e,t,r)=>{r.d(t,{_:()=>a});var o=r(53524);let a=globalThis.prisma??new o.PrismaClient({log:["query","error","warn"],datasources:{db:{url:process.env.DATABASE_URL}}});(async(e=3,t=1e3)=>{for(let r=0;r<e;r++)try{await a.$connect(),console.log("Successfully connected to MongoDB via Prisma");return}catch(o){console.error(`Failed to connect to database (attempt ${r+1}/${e}):`,o),r===e-1&&(console.error("Max retries reached. Exiting process..."),process.exit(1)),console.log(`Retrying in ${t}ms...`),await new Promise(e=>setTimeout(e,t))}})()}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[1638,6206],()=>r(26266));module.exports=o})();