"use strict";(()=>{var e={};e.id=1743,e.ids=[1743],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},29099:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>v,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>w});var a={};r.r(a),r.d(a,{GET:()=>l,dynamic:()=>h});var o=r(95419),s=r(69108),n=r(99678),i=r(78070),c=r(81494),u=r(46082);let h="force-dynamic";async function l(e){try{let t=(e.headers.get("cookie")||"").match(/token=([^;]+)/),r=t?t[1]:null;if(!r)return i.Z.json({error:"Not authenticated"},{status:401});try{(0,u.verify)(r,process.env.JWT_SECRET||"your-secret-key")}catch{return i.Z.json({error:"Invalid token"},{status:401})}let{searchParams:a}=new URL(e.url),o=a.get("userId"),s=a.get("matchedUserId");if(!o||!s)return i.Z.json({error:"Both userId and matchedUserId are required"},{status:400});let n=await c._.preferences.findUnique({where:{userId:o}});if(!n)return i.Z.json({error:"User preferences not found"},{status:404});let h=await c._.profile.findUnique({where:{userId:s}});if(!h)return i.Z.json({error:"Matched profile not found"},{status:404});let l=await c._.user.findUnique({where:{id:s}});if(!l)return i.Z.json({error:"Matched user not found"},{status:404});let d=0,m=[];if(n.ageFrom&&n.ageTo){let e=function(e){let t=new Date,r=new Date(e),a=t.getFullYear()-r.getFullYear(),o=t.getMonth()-r.getMonth();return(o<0||0===o&&t.getDate()<r.getDate())&&a--,a}(l.dob);e>=n.ageFrom&&e<=n.ageTo?(d+=20,m.push({name:"Age",score:20,matched:!0})):m.push({name:"Age",score:0,matched:!1})}if(n.religion&&h.religion&&(n.religion===h.religion?(d+=20,m.push({name:"Religion",score:20,matched:!0})):m.push({name:"Religion",score:0,matched:!1})),n.education&&h.education&&(n.education===h.education?(d+=15,m.push({name:"Education",score:15,matched:!0})):m.push({name:"Education",score:0,matched:!1})),n.heightFrom&&n.heightTo&&h.height){let e=parseInt(h.height),t=parseInt(n.heightFrom),r=parseInt(n.heightTo);isNaN(e)||isNaN(t)||isNaN(r)||!(e>=t)||!(e<=r)?m.push({name:"Height",score:0,matched:!1}):(d+=15,m.push({name:"Height",score:15,matched:!0}))}return n.location&&h.workLocation&&(n.location===h.workLocation?(d+=15,m.push({name:"Location",score:15,matched:!0})):m.push({name:"Location",score:0,matched:!1})),n.occupation&&h.occupation&&(n.occupation===h.occupation?(d+=10,m.push({name:"Occupation",score:10,matched:!0})):m.push({name:"Occupation",score:0,matched:!1})),n.maritalStatus&&h.maritalStatus&&(n.maritalStatus===h.maritalStatus?(d+=5,m.push({name:"Marital Status",score:5,matched:!0})):m.push({name:"Marital Status",score:0,matched:!1})),i.Z.json({score:d,criteria:m,profile:h})}catch(e){return console.error("Error calculating match details:",e),i.Z.json({error:"Failed to calculate match details",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/matches/details/route",pathname:"/api/matches/details",filename:"route",bundlePath:"app/api/matches/details/route"},resolvedPagePath:"/home/subvivah/htdocs/subvivah.com/src/app/api/matches/details/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:p,serverHooks:g,headerHooks:f,staticGenerationBailout:w}=d,v="/api/matches/details/route";function y(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}},81494:(e,t,r)=>{r.d(t,{_:()=>o});var a=r(53524);let o=globalThis.prisma??new a.PrismaClient({log:["query","error","warn"],datasources:{db:{url:process.env.DATABASE_URL}}});(async(e=3,t=1e3)=>{for(let r=0;r<e;r++)try{await o.$connect(),console.log("Successfully connected to MongoDB via Prisma");return}catch(a){console.error(`Failed to connect to database (attempt ${r+1}/${e}):`,a),r===e-1&&(console.error("Max retries reached. Exiting process..."),process.exit(1)),console.log(`Retrying in ${t}ms...`),await new Promise(e=>setTimeout(e,t))}})()}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,6082],()=>r(29099));module.exports=a})();