"use strict";(()=>{var e={};e.id=2670,e.ids=[2670],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},68031:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>v,originalPathname:()=>g,patchFetch:()=>m,requestAsyncStorage:()=>f,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y,staticGenerationBailout:()=>w});var a={};r.r(a),r.d(a,{GET:()=>u,POST:()=>p,PUT:()=>d});var n=r(95419),i=r(69108),o=r(99678),s=r(78070),c=r(81494);async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("userId");if(!r)return new s.Z(JSON.stringify({error:"User ID is required"}),{status:400,headers:{"Content-Type":"application/json"}});try{let e=await c._.verification.findUnique({where:{userId:r}});return new s.Z(JSON.stringify(e),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Database error:",e),new s.Z(JSON.stringify({error:"Failed to fetch verification status"}),{status:500,headers:{"Content-Type":"application/json"}})}}catch(e){return console.error("API error:",e),new s.Z(JSON.stringify({error:"Internal server error"}),{status:500,headers:{"Content-Type":"application/json"}})}}async function p(e){try{let{userId:t,documentType:r,documentUrl:a,selfieUrl:n}=await e.json();if(!t||!r||!a||!n)return new s.Z(JSON.stringify({error:"Missing required fields"}),{status:400,headers:{"Content-Type":"application/json"}});try{let e=await c._.verification.upsert({where:{userId:t},update:{documentType:r,documentUrl:a,selfieUrl:n,status:"pending",submittedAt:new Date},create:{userId:t,documentType:r,documentUrl:a,selfieUrl:n,status:"pending",submittedAt:new Date}});return await c._.notification.create({data:{userId:"admin",type:"verification",message:`New verification request from user ${t}`}}),new s.Z(JSON.stringify(e),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Database error:",e),new s.Z(JSON.stringify({error:"Failed to submit verification request"}),{status:500,headers:{"Content-Type":"application/json"}})}}catch(e){return console.error("API error:",e),new s.Z(JSON.stringify({error:"Internal server error"}),{status:500,headers:{"Content-Type":"application/json"}})}}async function d(e){try{let{userId:t,status:r,adminNotes:a}=await e.json();if(!t||!r||!["approved","rejected"].includes(r))return new s.Z(JSON.stringify({error:"Invalid request data"}),{status:400,headers:{"Content-Type":"application/json"}});try{let e=await c._.verification.update({where:{userId:t},data:{status:r,adminNotes:a,reviewedAt:new Date}});return await c._.notification.create({data:{userId:t,type:"verification",message:`Your verification request has been ${r}`}}),new s.Z(JSON.stringify(e),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Database error:",e),new s.Z(JSON.stringify({error:"Failed to update verification status"}),{status:500,headers:{"Content-Type":"application/json"}})}}catch(e){return console.error("API error:",e),new s.Z(JSON.stringify({error:"Internal server error"}),{status:500,headers:{"Content-Type":"application/json"}})}}let l=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/verification/route",pathname:"/api/verification",filename:"route",bundlePath:"app/api/verification/route"},resolvedPagePath:"/home/subvivah/htdocs/subvivah.com/src/app/api/verification/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:h,headerHooks:v,staticGenerationBailout:w}=l,g="/api/verification/route";function m(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}},81494:(e,t,r)=>{r.d(t,{_:()=>n});var a=r(53524);let n=globalThis.prisma??new a.PrismaClient({log:["query","error","warn"],datasources:{db:{url:process.env.DATABASE_URL}}});(async(e=3,t=1e3)=>{for(let r=0;r<e;r++)try{await n.$connect(),console.log("Successfully connected to MongoDB via Prisma");return}catch(a){console.error(`Failed to connect to database (attempt ${r+1}/${e}):`,a),r===e-1&&(console.error("Max retries reached. Exiting process..."),process.exit(1)),console.log(`Retrying in ${t}ms...`),await new Promise(e=>setTimeout(e,t))}})()}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206],()=>r(68031));module.exports=a})();