(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4750],{5858:function(e,t,s){Promise.resolve().then(s.bind(s,16092))},16092:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return k}});var r=s(3827),i=s(64090),l=s(47907),a=s(20703),n=s(28670),o=s(79580),c=s(54525),d=s.n(c);function m(e){let{onUserSelect:t}=e,[s,c]=(0,i.useState)(""),[m,x]=(0,i.useState)([]),[u,h]=(0,i.useState)(!1),[p,f]=(0,i.useState)(!1);(0,l.useRouter)();let g=(0,i.useCallback)(d()(async e=>{if(!e.trim()){x([]),h(!1);return}try{let t=await fetch("/api/users/search?query=".concat(encodeURIComponent(e))),s=await t.json();x(s.users)}catch(e){console.error("Search error:",e)}finally{h(!1)}},300),[]);(0,i.useEffect)(()=>{h(!0),g(s)},[s,g]);let v=e=>{t(e),f(!1),c("")};return(0,r.jsxs)("div",{className:"relative w-full",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",value:s,onChange:e=>{c(e.target.value),f(!0)},onFocus:()=>f(!0),placeholder:"Search users...",className:"w-full px-4 py-2 pl-10 pr-4 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),(0,r.jsx)(n.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),u&&(0,r.jsx)(o.Z,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 animate-spin"})]}),p&&(s.trim()||m.length>0)&&(0,r.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-96 overflow-y-auto",children:m.length>0?m.map(e=>(0,r.jsxs)("button",{onClick:()=>v(e),className:"w-full px-4 py-2 text-left hover:bg-gray-50 flex items-center gap-3 transition-colors",children:[(0,r.jsx)("div",{className:"relative w-8 h-8 rounded-full overflow-hidden flex-shrink-0",children:e.photo?(0,r.jsx)(a.default,{src:e.photo,alt:"".concat(e.firstName," ").concat(e.lastName),fill:!0,className:"object-cover"}):(0,r.jsx)("div",{className:"w-full h-full bg-purple-100 flex items-center justify-center",children:(0,r.jsxs)("span",{className:"text-purple-600 font-medium",children:[e.firstName[0],e.lastName[0]]})})}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)("h3",{className:"font-medium text-black",children:[e.firstName," ",e.lastName]})})]},e.id)):(0,r.jsx)("div",{className:"px-4 py-2 text-sm text-gray-500",children:u?"Searching...":"No users found"})})]})}var x=s(73125),u=s(77326),h=s(85497),p=s(20933),f=s(26490),g=s(67366),v=s(55211),w=s(51652),N=s(19175);let j=[{icon:(0,r.jsx)(u.Z,{className:"w-8 h-8 text-blue-400"}),title:"Secure Communication",description:"End-to-end encrypted messaging ensures your conversations remain private and protected"},{icon:(0,r.jsx)(h.Z,{className:"w-8 h-8 text-green-400"}),title:"Verified Profiles",description:"All members are thoroughly verified to ensure authentic connections"},{icon:(0,r.jsx)(p.Z,{className:"w-8 h-8 text-purple-400"}),title:"Privacy Controls",description:"Customize your privacy settings and control who can contact you"},{icon:(0,r.jsx)(f.Z,{className:"w-8 h-8 text-pink-400"}),title:"Response Time",description:"Quick response indicators help maintain active conversations"}],b=[{title:"Meaningful Connections",description:"Build genuine relationships with like-minded individuals"},{title:"Safe Environment",description:"Our moderation team ensures a respectful communication space"},{title:"Privacy First",description:"Your personal information is never shared without your consent"},{title:"Quality Matches",description:"Connect with people who share your values and interests"}];function y(){return(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-indigo-950 via-purple-900 to-indigo-950",children:[(0,r.jsx)("div",{className:"relative overflow-hidden py-24",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("h1",{className:"text-4xl md:text-6xl font-bold text-white mb-6 flex items-center justify-center gap-3",children:[(0,r.jsx)(g.Z,{className:"text-blue-400"}),"Secure Messaging",(0,r.jsx)(v.Z,{className:"text-pink-400"})]}),(0,r.jsx)("p",{className:"text-xl md:text-2xl text-purple-200 mb-12",children:"Connect safely and build meaningful relationships through our trusted platform"}),(0,r.jsx)("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-8 max-w-3xl mx-auto",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-purple-600/30 rounded-full flex items-center justify-center mb-4",children:(0,r.jsx)(w.Z,{className:"w-8 h-8 text-purple-200"})}),(0,r.jsx)("p",{className:"text-lg text-purple-200 mb-4",children:"Login to start connecting with your matches through our secure messaging system"}),(0,r.jsx)("div",{className:"flex flex-col sm:flex-row gap-4",children:(0,r.jsx)("button",{onClick:()=>{"function"==typeof window.showLoginPopup&&window.showLoginPopup()},className:"px-8 py-3 bg-purple-600 text-white rounded-lg text-lg font-semibold hover:bg-purple-700 transition-colors select-none",children:"Start Messaging"})})]})})]})})}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-white text-center mb-12",children:"Why Trust Our Platform?"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:j.map((e,t)=>(0,r.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 transform hover:scale-105 transition-all duration-300 select-none",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mb-4",children:e.icon}),(0,r.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:e.title}),(0,r.jsx)("p",{className:"text-purple-200",children:e.description})]},t))})]}),(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16",children:(0,r.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-8",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-white text-center mb-12",children:"Benefits of Our Messaging System"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:b.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-start gap-4 select-none",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(N.Z,{className:"w-6 h-6 text-green-400"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:e.title}),(0,r.jsx)("p",{className:"text-purple-200",children:e.description})]})]},t))})]})}),(0,r.jsx)("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-16",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-white mb-6",children:"Ready to Start Connecting?"}),(0,r.jsx)("p",{className:"text-lg text-purple-200 mb-8",children:"Join our trusted community and begin your journey to meaningful relationships"}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,r.jsx)("button",{onClick:()=>{"function"==typeof window.showLoginPopup&&window.showLoginPopup()},className:"px-8 py-3 bg-purple-600 text-white rounded-lg text-lg font-semibold hover:bg-purple-700 transition-colors select-none",children:"Login Now"}),(0,r.jsx)("button",{onClick:()=>window.location.href="/register",className:"px-8 py-3 bg-pink-600 text-white rounded-lg text-lg font-semibold hover:bg-pink-700 transition-colors select-none",children:"Create Account"})]})]})})]})}function k(){var e,t;let[s,l]=(0,i.useState)(!1),[a,n]=(0,i.useState)(!0),[o,c]=(0,i.useState)(null),[d,u]=(0,i.useState)([]),[h,p]=(0,i.useState)(""),[f,g]=(0,i.useState)([]),[v,w]=(0,i.useState)(null),[N,j]=(0,i.useState)(""),b=(0,i.useRef)(null),k=async e=>{try{let t=await fetch("/api/messages?conversationId=".concat(e));if(!t.ok)throw Error("Failed to fetch messages");let s=await t.json();u(s.messages)}catch(e){console.error("Error fetching messages:",e)}},S=async()=>{try{let e=await fetch("/api/messages/conversations");if(!e.ok)throw Error("Failed to fetch conversations");let t=await e.json();g(t.conversations)}catch(e){console.error("Error fetching conversations:",e)}},C=async e=>{if(e.preventDefault(),!h.trim()||!o)return;let t=h.trim();p("");let s={id:"temp-".concat(Date.now()),content:t,createdAt:new Date().toISOString(),senderId:"current-user",receiverId:o.id,isRead:!1};u(e=>[...e,s]);let r={...o,lastMessage:t,lastMessageTime:new Date().toISOString(),unreadCount:0};g(e=>[r,...e.filter(e=>e.id!==o.id)]);try{let e=await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({receiverId:o.id,content:t})});if(!e.ok)throw Error("Failed to send message");let r=await e.json();u(e=>e.map(e=>e.id===s.id?{...r,createdAt:s.createdAt}:e))}catch(e){console.error("Error sending message:",e),u(e=>e.filter(e=>e.id!==s.id)),p(t),alert("Failed to send message. Please try again.")}},E=e=>{try{let t=new Date(e);if(isNaN(t.getTime()))return"";return(0,x.WU)(t,"h:mm a")}catch(e){return console.error("Error formatting date:",e),""}};return((0,i.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me"),t=await e.json();if(l(t.isAuthenticated),!t.isAuthenticated){let e=setTimeout(()=>{"function"==typeof window.showLoginPopup&&window.showLoginPopup()},4e3);return()=>clearTimeout(e)}}catch(e){console.error("Auth check error:",e),l(!1)}finally{n(!1)}})()},[]),(0,i.useEffect)(()=>{if(!a&&s){S();let e=setInterval(S,1e4);return()=>clearInterval(e)}},[a,s]),(0,i.useEffect)(()=>{if(o&&s){k(o.id);let e=setInterval(()=>k(o.id),5e3);return()=>clearInterval(e)}},[o,s]),(0,i.useEffect)(()=>{var e;null===(e=b.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[d]),a)?(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-indigo-950 via-purple-900 to-indigo-950 flex items-center justify-center relative overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute inset-0 backdrop-blur-md z-0"}),(0,r.jsxs)("div",{className:"relative z-10 flex flex-col items-center",children:[(0,r.jsxs)("svg",{className:"animate-spin h-14 w-14 text-purple-300 mb-4",viewBox:"0 0 50 50",children:[(0,r.jsx)("circle",{className:"opacity-20",cx:"25",cy:"25",r:"20",stroke:"currentColor",strokeWidth:"5",fill:"none"}),(0,r.jsx)("circle",{className:"opacity-70",cx:"25",cy:"25",r:"20",stroke:"currentColor",strokeWidth:"5",fill:"none",strokeDasharray:"31.4 94.2"})]}),(0,r.jsx)("span",{className:"text-purple-200 text-lg font-medium animate-pulse",children:"Loading..."})]})]}):s?(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-indigo-950 via-purple-900 to-indigo-950 py-8 relative overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute top-4 left-8 animate-bounce text-blue-200 text-3xl z-10",children:"\uD83D\uDCAC"}),(0,r.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,r.jsx)("div",{className:"p-4 bg-white/10 backdrop-blur-sm border-b border-white/20 shadow-sm",children:(0,r.jsx)(m,{onUserSelect:e=>{if(!e||!e.id||!e.firstName||!e.lastName){console.error("Invalid user data:",e);return}let t=f.find(t=>t.id===e.id);if(t){c(t);return}let s={id:e.id,firstName:e.firstName,lastName:e.lastName,photo:e.photo||null,lastMessage:"",lastMessageTime:new Date().toISOString(),unreadCount:0};c(s),g(e=>[s,...e])}})}),(0,r.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,r.jsx)("div",{className:"w-1/3 border-r border-white/20 bg-white/5 overflow-y-auto shadow-sm",children:(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4 text-white",children:"Conversations"}),(0,r.jsx)("div",{className:"space-y-2",children:f.map(e=>(0,r.jsxs)("div",{className:"flex items-center p-3 cursor-pointer hover:bg-white/10 rounded-lg transition-colors ".concat((null==o?void 0:o.id)===e.id?"bg-purple-500/20":""),onClick:()=>c(e),children:[(0,r.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-700 flex items-center justify-center overflow-hidden mr-3 ring-2 ring-offset-2 ring-purple-400/50 flex-shrink-0",children:e.photo?(0,r.jsx)("img",{src:e.photo,alt:"".concat(e.firstName," ").concat(e.lastName),className:"w-full h-full object-cover"}):(0,r.jsxs)("span",{className:"text-white text-lg",children:[e.firstName[0],e.lastName[0]]})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("h3",{className:"font-medium text-white truncate",children:[e.firstName," ",e.lastName]}),(0,r.jsx)("span",{className:"text-sm text-gray-300 ml-2 flex-shrink-0",children:(0,x.WU)(new Date(e.lastMessageTime),"MMM d, h:mm a")})]}),(0,r.jsx)("p",{className:"text-sm text-gray-300 truncate",children:e.lastMessage})]}),e.unreadCount>0&&(0,r.jsx)("div",{className:"ml-2 bg-purple-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0",children:e.unreadCount})]},e.id))})]})}),(0,r.jsx)("div",{className:"flex-1 flex flex-col bg-gradient-to-br from-indigo-900/50 via-purple-900/50 to-indigo-950/50 backdrop-blur-sm",children:o?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"p-4 border-b border-white/10 flex items-center bg-white/5 shadow-sm",children:[(0,r.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center overflow-hidden mr-3 ring-2 ring-offset-2 ring-purple-400/50 flex-shrink-0",children:(null==o?void 0:o.photo)?(0,r.jsx)("img",{src:o.photo,alt:"".concat(o.firstName," ").concat(o.lastName),className:"w-full h-full object-cover"}):(0,r.jsxs)("span",{className:"text-white",children:[(null==o?void 0:null===(e=o.firstName)||void 0===e?void 0:e[0])||"",(null==o?void 0:null===(t=o.lastName)||void 0===t?void 0:t[0])||""]})}),(0,r.jsx)("div",{children:(0,r.jsxs)("h3",{className:"font-medium text-white",children:[null==o?void 0:o.firstName," ",null==o?void 0:o.lastName]})})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:(0,r.jsxs)("div",{className:"max-w-3xl mx-auto space-y-4",children:[d.map(e=>(0,r.jsxs)("div",{className:"flex flex-col ".concat(e.senderId===o.id?"items-start":"items-end"," group"),children:[(0,r.jsx)("div",{className:"max-w-[70%] rounded-lg p-3 shadow-sm ".concat(e.senderId===o.id?"bg-white/10 text-white border border-purple-400/20":"bg-purple-600/90 text-white"),children:(0,r.jsx)("p",{children:e.content})}),(0,r.jsx)("div",{className:"flex items-center gap-2 mt-1 px-1",children:(0,r.jsx)("span",{className:"text-xs text-purple-200",children:E(e.createdAt)})})]},e.id)),(0,r.jsx)("div",{ref:b})]})}),(0,r.jsx)("form",{onSubmit:C,className:"p-4 border-t border-white/10 bg-white/5 shadow-sm",children:(0,r.jsx)("div",{className:"max-w-3xl mx-auto",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),placeholder:"Type a message...",className:"flex-1 p-2 bg-white/10 text-white placeholder-gray-400 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors flex-shrink-0",children:"Send"})]})})})]}):(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center text-gray-300 bg-white/5",children:"Select a conversation to start messaging"})})]})]})]}):(0,r.jsx)(y,{})}}},function(e){e.O(0,[1749,5002,2971,8069,1744],function(){return e(e.s=5858)}),_N_E=e.O()}]);