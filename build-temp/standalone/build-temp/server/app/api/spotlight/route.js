"use strict";(()=>{var e={};e.id=3110,e.ids=[3110],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},77794:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>m,originalPathname:()=>w,patchFetch:()=>L,requestAsyncStorage:()=>p,routeModule:()=>h,serverHooks:()=>g,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>f});var o={};t.r(o),t.d(o,{GET:()=>l,dynamic:()=>u});var a=t(95419),s=t(69108),n=t(99678),i=t(78070),c=t(81494);let u="force-dynamic";async function l(e){try{let{searchParams:r}=new URL(e.url),t=r.get("userId"),o="true"===r.get("all");if(!t)return i.Z.json({error:"User ID is required"},{status:400});console.log("Fetching matches for user:",t);try{let e=await c._.profile.findUnique({where:{userId:t},include:{user:!0}});if(!e)return console.log("User profile not found for ID:",t),i.Z.json({error:"User profile not found"},{status:404});let r=e.user.gender?.toUpperCase();console.log("User gender:",r);let a=await c._.preferences.findUnique({where:{userId:t}});if(!a)return console.log("User preferences not found for ID:",t),i.Z.json({error:"User preferences not found"},{status:404});console.log("Found user preferences:",a);let s=await c._.profile.findMany({where:{userId:{not:t},user:{gender:{equals:"MALE"===r?"FEMALE":"MALE",mode:"insensitive"}}},select:{id:!0,userId:!0,height:!0,maritalStatus:!0,religion:!0,caste:!0,education:!0,occupation:!0,workLocation:!0,aboutMe:!0,user:{select:{id:!0,email:!0,firstName:!0,lastName:!0,dob:!0,gender:!0}}}});if(console.log("Found potential matches:",s.length),0===s.length)return i.Z.json({error:"No potential matches found"},{status:404});let n=s.map(e=>{try{let r=0,t=[];if(a.ageFrom&&a.ageTo&&e.user.dob){let o=new Date().getFullYear()-new Date(e.user.dob).getFullYear();o>=a.ageFrom&&o<=a.ageTo&&(r+=20,t.push("Age"))}if(a.religion&&e.religion?.toLowerCase()===a.religion.toLowerCase()&&(r+=20,t.push("Religion")),a.education&&e.education?.toLowerCase()===a.education.toLowerCase()&&(r+=15,t.push("Education")),a.heightFrom&&a.heightTo&&e.height)try{let o=parseInt(e.height),s=parseInt(a.heightFrom),n=parseInt(a.heightTo);isNaN(o)||isNaN(s)||isNaN(n)||!(o>=s)||!(o<=n)||(r+=15,t.push("Height"))}catch(e){console.error("Error parsing height:",e)}return a.location&&e.workLocation?.toLowerCase()===a.location.toLowerCase()&&(r+=15,t.push("Location")),a.occupation&&e.occupation?.toLowerCase()===a.occupation.toLowerCase()&&(r+=10,t.push("Occupation")),a.maritalStatus&&e.maritalStatus?.toLowerCase()===a.maritalStatus.toLowerCase()&&(r+=5,t.push("Marital Status")),{profile:e,matchScore:r,matchingCriteria:t}}catch(r){return console.error("Error scoring match:",r),{profile:e,matchScore:0,matchingCriteria:[]}}}).sort((e,r)=>r.matchScore-e.matchScore);if(o)return i.Z.json({matches:n});{let e=n[0];if(!e||e.matchScore<20)return i.Z.json({error:"No suitable matches found"},{status:404});return i.Z.json({matchedProfile:e.profile,matchScore:e.matchScore,matchingCriteria:e.matchingCriteria})}}catch(e){return console.error("Database operation error:",e),i.Z.json({error:"Database operation failed",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}catch(e){return console.error("API error:",e),i.Z.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/spotlight/route",pathname:"/api/spotlight",filename:"route",bundlePath:"app/api/spotlight/route"},resolvedPagePath:"/home/subvivah/htdocs/subvivah.com/src/app/api/spotlight/route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:g,headerHooks:m,staticGenerationBailout:f}=h,w="/api/spotlight/route";function L(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:d})}},81494:(e,r,t)=>{t.d(r,{_:()=>a});var o=t(53524);let a=globalThis.prisma??new o.PrismaClient({log:["query","error","warn"],datasources:{db:{url:process.env.DATABASE_URL}}});(async(e=3,r=1e3)=>{for(let t=0;t<e;t++)try{await a.$connect(),console.log("Successfully connected to MongoDB via Prisma");return}catch(o){console.error(`Failed to connect to database (attempt ${t+1}/${e}):`,o),t===e-1&&(console.error("Max retries reached. Exiting process..."),process.exit(1)),console.log(`Retrying in ${r}ms...`),await new Promise(e=>setTimeout(e,r))}})()}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[1638,6206],()=>t(77794));module.exports=o})();