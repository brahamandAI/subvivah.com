"use strict";(()=>{var e={};e.id=6345,e.ids=[6345],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},57048:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>b,patchFetch:()=>v,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>g});var a={};r.r(a),r.d(a,{POST:()=>c});var o=r(95419),i=r(69108),n=r(99678),s=r(78070),l=r(81494),u=r(46082);async function c(e){try{let{accessToken:t}=await e.json();if(!t)return s.Z.json({error:"Access token is required"},{status:400});let r=await fetch(`https://graph.facebook.com/v12.0/me?fields=id,name,email,picture&access_token=${t}`),a=await r.json();if(!a.id)return s.Z.json({error:"Invalid token"},{status:400});let{email:o,name:i,picture:n}=a,c=await l._.user.findUnique({where:{email:o},include:{profile:!0}});c||(c=await l._.user.create({data:{email:o,password:"",firstName:a.name?.split(" ")[0]||"",lastName:a.name?.split(" ").slice(1).join(" ")||"",gender:"",dob:new Date,isVerified:!0,isActive:!0,profile:{create:{height:null,weight:null,maritalStatus:null,religion:null,caste:null,motherTongue:null,education:null,occupation:null,annualIncome:null,workLocation:null,fatherName:null,fatherOccupation:null,motherName:null,motherOccupation:null,siblings:null,familyType:null,familyStatus:null,aboutMe:null,hobbies:null}}},include:{profile:!0}}));let p=(0,u.sign)({userId:c.id},process.env.JWT_SECRET||"your-secret-key",{expiresIn:"7d"}),d=s.Z.json({user:{id:c.id,email:c.email,firstName:c.firstName,lastName:c.lastName,emailVerified:c.isVerified,profile:c.profile}});return d.cookies.set("token",p,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800}),d}catch(e){return console.error("Facebook authentication error:",e),s.Z.json({error:"Authentication failed"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/facebook/route",pathname:"/api/auth/facebook",filename:"route",bundlePath:"app/api/auth/facebook/route"},resolvedPagePath:"/home/subvivah/htdocs/subvivah.com/src/app/api/auth/facebook/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:h,headerHooks:f,staticGenerationBailout:g}=p,b="/api/auth/facebook/route";function v(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},81494:(e,t,r)=>{r.d(t,{_:()=>o});var a=r(53524);let o=globalThis.prisma??new a.PrismaClient({log:["query","error","warn"],datasources:{db:{url:process.env.DATABASE_URL}}});(async(e=3,t=1e3)=>{for(let r=0;r<e;r++)try{await o.$connect(),console.log("Successfully connected to MongoDB via Prisma");return}catch(a){console.error(`Failed to connect to database (attempt ${r+1}/${e}):`,a),r===e-1&&(console.error("Max retries reached. Exiting process..."),process.exit(1)),console.log(`Retrying in ${t}ms...`),await new Promise(e=>setTimeout(e,t))}})()}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,6082],()=>r(57048));module.exports=a})();