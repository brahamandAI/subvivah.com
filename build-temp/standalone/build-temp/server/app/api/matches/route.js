"use strict";(()=>{var e={};e.id=5450,e.ids=[5450],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},74178:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>m});var a={};r.r(a),r.d(a,{GET:()=>u,POST:()=>l});var n=r(95419),o=r(69108),s=r(99678),i=r(78070),c=r(81494);async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("userId"),a=parseInt(t.get("page")||"1"),n=parseInt(t.get("limit")||"10");if(!r)return new i.Z(JSON.stringify({error:"User ID is required"}),{status:400,headers:{"Content-Type":"application/json"}});try{let e=await c._.preferences.findUnique({where:{userId:r}});if(!e)return new i.Z(JSON.stringify({error:"User preferences not found"}),{status:404,headers:{"Content-Type":"application/json"}});let t=await c._.profile.findUnique({where:{userId:r},include:{user:!0}});if(!t)return new i.Z(JSON.stringify({error:"User profile not found"}),{status:404,headers:{"Content-Type":"application/json"}});let o={AND:[{userId:{not:r}},{user:{gender:{not:t.user.gender}}},e.ageFrom&&e.ageTo?{user:{dob:{lte:new Date(new Date().setFullYear(new Date().getFullYear()-e.ageFrom)),gte:new Date(new Date().setFullYear(new Date().getFullYear()-e.ageTo))}}}:{},e.heightFrom&&e.heightTo?{height:{gte:e.heightFrom,lte:e.heightTo}}:{},e.maritalStatus?{maritalStatus:e.maritalStatus}:{},e.religion?{religion:e.religion}:{},e.caste?{caste:e.caste}:{},e.education?{education:e.education}:{},e.occupation?{occupation:e.occupation}:{},e.location?{workLocation:e.location}:{}].filter(e=>Object.keys(e).length>0)},s=await c._.profile.count({where:o}),u=await c._.profile.findMany({where:o,skip:(a-1)*n,take:n,include:{user:{select:{firstName:!0,lastName:!0,email:!0,photos:{where:{isProfile:!0},take:1}}}}});return new i.Z(JSON.stringify({matches:u,pagination:{total:s,page:a,limit:n,totalPages:Math.ceil(s/n)}}),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Database error:",e),new i.Z(JSON.stringify({error:"Failed to fetch matches"}),{status:500,headers:{"Content-Type":"application/json"}})}}catch(e){return console.error("API error:",e),new i.Z(JSON.stringify({error:"Internal server error"}),{status:500,headers:{"Content-Type":"application/json"}})}}async function l(e){try{let{userId:t,matchId:r,status:a}=await e.json();if(!t||!r||!a)return new i.Z(JSON.stringify({error:"User ID, match ID, and status are required"}),{status:400,headers:{"Content-Type":"application/json"}});try{let e=await c._.interest.upsert({where:{senderId_receiverId:{senderId:t,receiverId:r}},update:{status:a},create:{senderId:t,receiverId:r,status:a}});return new i.Z(JSON.stringify(e),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Database error:",e),new i.Z(JSON.stringify({error:"Failed to save match status"}),{status:500,headers:{"Content-Type":"application/json"}})}}catch(e){return console.error("API error:",e),new i.Z(JSON.stringify({error:"Internal server error"}),{status:500,headers:{"Content-Type":"application/json"}})}}let p=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/matches/route",pathname:"/api/matches",filename:"route",bundlePath:"app/api/matches/route"},resolvedPagePath:"/home/subvivah/htdocs/subvivah.com/src/app/api/matches/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:g,headerHooks:f,staticGenerationBailout:m}=p,w="/api/matches/route";function y(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},81494:(e,t,r)=>{r.d(t,{_:()=>n});var a=r(53524);let n=globalThis.prisma??new a.PrismaClient({log:["query","error","warn"],datasources:{db:{url:process.env.DATABASE_URL}}});(async(e=3,t=1e3)=>{for(let r=0;r<e;r++)try{await n.$connect(),console.log("Successfully connected to MongoDB via Prisma");return}catch(a){console.error(`Failed to connect to database (attempt ${r+1}/${e}):`,a),r===e-1&&(console.error("Max retries reached. Exiting process..."),process.exit(1)),console.log(`Retrying in ${t}ms...`),await new Promise(e=>setTimeout(e,t))}})()}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206],()=>r(74178));module.exports=a})();